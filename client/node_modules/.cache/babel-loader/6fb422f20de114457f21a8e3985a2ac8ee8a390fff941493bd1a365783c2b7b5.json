{"ast":null,"code":"import React,{useContext,useEffect,useState}from'react';import{Button,Col,Container,Dropdown,Form,Image,Modal,Row}from\"react-bootstrap\";import{useParams}from'react-router-dom';import{fetchDeleteDevice,fetchOneDevice,updateDevices}from\"../http/deviceAPI\";import{Context}from\"../index\";import{ADMIN_ROUTE}from\"../utils/consts\";import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DevicePageEdit=()=>{const{device}=useContext(Context);const{id}=useParams();const[deviceCurr,setDeviceCurr]=useState({});const[showMsg,setShowMsg]=useState(false);const[msg,setMsg]=useState(\"\");const[selectBrand,setSelectBrand]=useState({});const[selectType,setSelectType]=useState({});const[name,setName]=useState(\"\");const[price,setPrice]=useState(0);const[img,setImg]=useState(\"\");const[imgFile,setImgFile]=useState(null);const[info,setInfo]=useState([]);const[isDisabledPutBtn,setDisabledPutBtn]=useState(true);const navigate=useNavigate();const deleteDevice=()=>{fetchDeleteDevice(id).then(()=>{navigate(ADMIN_ROUTE);// Используем хук useNavigate для навигации\n});};const[show,setShow]=useState(false);const handleClose=()=>setShow(false);const handleShow=()=>setShow(true);const imgHandler=e=>{e.preventDefault();const reader=new FileReader();reader.onload=()=>{setImg(reader.result);};reader.readAsDataURL(e.target.files[0]);setImgFile(e.target.files[0]);};//info\nconst addInfo=()=>{setInfo([...info,{title:'',description:'',id:Date.now()}]);};const deleteInfo=number=>{setInfo(info.filter(item=>item.number!==number));};const changeInfo=(key,value,number)=>{setInfo(info.map(i=>i.id===number?{...i,[key]:value}:i));};const putDevice=()=>{const formData=new FormData();formData.append('name',name);formData.append('price',\"\".concat(price));formData.append('img',imgFile);formData.append('brandId',selectBrand.id);formData.append('typeId',selectType.id);formData.append('info',JSON.stringify(info));updateDevices(id,formData).then(data=>{setShowMsg(true);setMsg(data);setTimeout(()=>setShowMsg(true),5000);});};const checkInfo=()=>{let isInfoEmpty=true;info.forEach(item=>{for(let key in item){if(key===\"title\"||key===\"description\"){if(!item[key]){isInfoEmpty=false;}}}});return isInfoEmpty;};useEffect(()=>{let checkInfoVal=false;if(deviceCurr.info&&deviceCurr.info.length!==info.length){checkInfoVal=checkInfo();}if(deviceCurr&&deviceCurr.brand&&deviceCurr.type){if(deviceCurr.brand.name!==selectBrand.name||deviceCurr.type.name!==selectType.name||deviceCurr.name!==name||deviceCurr.price!==price||checkInfoVal||img){setDisabledPutBtn(false);}else{setDisabledPutBtn(true);}}},[name,selectBrand,selectType,price,img,info]);useEffect(()=>{fetchOneDevice(id).then(data=>{setDeviceCurr(data);setSelectBrand(data.brand);setSelectType(data.type);setName(data.name);setPrice(data.price);setInfo(data.info);});},[id]);return/*#__PURE__*/_jsxs(Container,{className:\"mt-3\",children:[showMsg&&/*#__PURE__*/_jsx(Row,{children:msg}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{xs:12,children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:1,className:\"d-flex align-items-center\",children:\"id:\"}),/*#__PURE__*/_jsx(Col,{xs:11,children:deviceCurr.id})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:1,className:\"d-flex align-items-center\",children:\"Brand:\"}),/*#__PURE__*/_jsx(Col,{xs:11,children:/*#__PURE__*/_jsxs(Dropdown,{className:\"mt-2 mb-2\",children:[/*#__PURE__*/_jsx(Dropdown.Toggle,{children:selectBrand.name||\"Choose Brand\"}),/*#__PURE__*/_jsx(Dropdown.Menu,{children:device.brands.map(brand=>{return brand.name===selectBrand.name?/*#__PURE__*/_jsx(Dropdown.Item,{disabled:true,children:brand.name},brand.id):/*#__PURE__*/_jsx(Dropdown.Item,{onClick:()=>setSelectBrand(brand),children:brand.name},brand.id);})})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:1,className:\"d-flex align-items-center\",children:\"Types:\"}),/*#__PURE__*/_jsx(Col,{xs:11,children:/*#__PURE__*/_jsxs(Dropdown,{className:\"mt-2 mb-2\",children:[/*#__PURE__*/_jsx(Dropdown.Toggle,{children:selectType.name||\"Choose Type\"}),/*#__PURE__*/_jsx(Dropdown.Menu,{children:device.types.map(type=>{return type.name===selectType.name?/*#__PURE__*/_jsx(Dropdown.Item,{disabled:true,children:type.name},type.id):/*#__PURE__*/_jsx(Dropdown.Item,{onClick:()=>setSelectType(type),children:type.name},type.id);})})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:1,className:\"d-flex align-items-center\",children:\"Name:\"}),/*#__PURE__*/_jsx(Col,{xs:8,children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:name,onChange:e=>setName(e.target.value)})}),/*#__PURE__*/_jsx(Col,{xs:3,className:\"d-flex align-items-center\",children:name.length===0&&/*#__PURE__*/_jsx(\"b\",{style:{color:\"red\"},children:\"Please input name of device\"})})]}),/*#__PURE__*/_jsxs(Row,{className:\"mt-2\",children:[/*#__PURE__*/_jsx(Col,{xs:1,className:\"d-flex align-items-center\",children:\"Price:\"}),/*#__PURE__*/_jsx(Col,{xs:8,children:/*#__PURE__*/_jsx(Form.Control,{type:\"number\",value:price,onChange:e=>setPrice(Number(e.target.value))})}),/*#__PURE__*/_jsx(Col,{xs:3,className:\"d-flex align-items-center\",children:price===0&&/*#__PURE__*/_jsx(\"b\",{style:{color:\"red\"},children:\"Please input price of device\"})})]}),/*#__PURE__*/_jsxs(Row,{className:\"mt-4\",children:[/*#__PURE__*/_jsxs(Col,{xs:3,className:\"d-flex flex-column justify-content-center text-center\",children:[\"Current Img: \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Image,{style:{margin:\"0 auto\",marginTop:15},width:150,src:process.env.REACT_APP_API_URL+deviceCurr.img})]}),img&&/*#__PURE__*/_jsxs(Col,{xs:6,className:\"d-flex flex-column justify-content-center text-center\",children:[\"New Img: \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Image,{style:{margin:\"0 auto\",marginTop:15},width:150,src:img})]}),/*#__PURE__*/_jsx(Col,{xs:3,className:\"d-flex align-items-center\",children:/*#__PURE__*/_jsx(Form.Group,{controlId:\"formFile\",className:\"mb-3\",children:/*#__PURE__*/_jsx(Form.Group,{children:/*#__PURE__*/_jsx(Form.File,{id:\"exampleFormControlFile1\",label:\"Upload file\",onChange:imgHandler})})})})]}),/*#__PURE__*/_jsxs(Row,{className:\"d-flex flex-column m-3\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Characteristics\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-dark\",onClick:()=>addInfo(),children:\"Add new property\"}),info.map((item,index)=>/*#__PURE__*/_jsxs(Row,{className:\"mt-3\",children:[/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(Form.Control,{placeholder:\"Input title for the device...\",value:item.title,onChange:e=>changeInfo('title',e.target.value,item.id)}),!info[index].title&&/*#__PURE__*/_jsx(\"b\",{style:{color:\"red\"},children:\"Please input name\"})]}),/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(Form.Control,{placeholder:\"Input description for the device...\",value:item.description,onChange:e=>changeInfo('description',e.target.value,item.id)}),!info[index].description&&/*#__PURE__*/_jsx(\"b\",{style:{color:\"red\"},children:\"Please input description\"})]}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Button,{variant:\"outline-danger\",onClick:()=>deleteInfo(item.number),children:\"Delete new property\"})})]},index))]}),/*#__PURE__*/_jsx(Row,{className:\"mt-5\",children:/*#__PURE__*/_jsxs(Col,{xs:12,children:[isDisabledPutBtn?/*#__PURE__*/_jsx(Button,{disabled:true,children:\"Update Device\"}):/*#__PURE__*/_jsx(Button,{onClick:putDevice,children:\"Update Device\"}),/*#__PURE__*/_jsx(Button,{className:\"ml-5\",variant:\"danger\",onClick:handleShow,children:\"Delete Device\"})]})})]})}),/*#__PURE__*/_jsxs(Modal,{show:show,onHide:handleClose,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Modal.Title,{children:[\"Delete this device \",deviceCurr.id,\"?\"]})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:deleteDevice,children:\"Delete\"})]})]})]});};export default DevicePageEdit;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}